@import "tailwindcss";

/* Global design tokens */
:root{
  --nav-h: 72px;
  --nav-w: 0px;
  --bg: #ffffff;
  --fg: #0a0a0a;
  --muted: #6b7280;
  --muted2: #9ca3af;
  --border: rgba(10,10,10,.12);
  --accent: #0a0a0a;
  --soft: rgba(10,10,10,.06);
}

html { scroll-behavior: smooth; }
body {
  background: var(--bg);
  color: var(--fg);
  overscroll-behavior: none;  
}

/* iOS toolbars: prefer dynamic viewport units when available */
.dvh{
  height: 100dvh;
}

/*
  Full-page scroll experience ("scroll down -> next page/section")
  Usage: wrap sections in a .snap-container and mark each section with .snap-section.
*/
.snap-container{
  /* Keep the navbar fixed while the content "pages" scroll under it */
  height: calc(100vh - var(--nav-h));
  height: calc(100svh - var(--nav-h)); /* better on mobile when browser toolbars expand/collapse */
  margin-top: var(--nav-h);
  overflow-y: auto;
  scroll-snap-type: y mandatory;
  scroll-behavior: smooth;
  -webkit-overflow-scrolling: touch;
}

/*
  iOS Safari quirk:
  `backdrop-filter` is unreliable inside momentum-scrolling containers
  (`-webkit-overflow-scrolling: touch`). This can make “glass” look like
  plain translucency (no blur) in sections like About/Games.

  On iOS, prefer stable blur over momentum scrolling.
*/
@supports (-webkit-touch-callout: none) {
  .snap-container{
    -webkit-overflow-scrolling: auto;
  }
}

.snap-section{
  min-height: calc(100vh - var(--nav-h));
  min-height: calc(100svh - var(--nav-h));
  scroll-snap-align: start;
  scroll-snap-stop: always;
}

/* Active-section effects (FullPageScroll toggles data-active) */
.snap-section .section-inner{
  opacity: 0.35;
  transform: translateY(14px);
  /* NOTE:
     Avoid using `filter` on large ancestors.
     `filter` creates a new stacking context and can break `backdrop-filter`
     for descendants (glass cards / dropdowns), especially on Safari/iOS.
     We keep the motion/opacity but remove the ancestor blur so glass works.
  */
  transition: opacity 500ms ease, transform 500ms ease;
}

.snap-section[data-active="true"] .section-inner{
  opacity: 1;
  transform: translateY(0);
  /* no filter here: keep glass reliable */
}


/* Per-section effects (trigger only when that section becomes active) */
.snap-section[data-section="about"] .section-inner{
  transform: translateY(22px) scale(0.99);
  opacity: 0.92;
}
.snap-section[data-section="about"][data-active="true"] .section-inner{
  transform: translateY(0) scale(1);
  opacity: 1;
}

.snap-section[data-section="resume"] .section-inner{
  transform: translateY(28px);
  opacity: 0.9;
}
.snap-section[data-section="resume"][data-active="true"] .section-inner{
  transform: translateY(0);
  opacity: 1;
}

.snap-section[data-section="games"] .section-inner{
  transform: translateY(18px) scale(0.985);
  opacity: 0.92;
}
.snap-section[data-section="games"][data-active="true"] .section-inner{
  transform: translateY(0) scale(1);
  opacity: 1;
}

/* When a game is embedded inside the Games section, keep the playable area visible on mobile.
   We allow internal scrolling within the card rather than pushing the canvas below the fold. */
.game-stage{
  overflow: auto;
  max-height: calc(100svh - var(--nav-h) - 180px);
}

/* When actively playing a game inside the Games section, prioritize the playable area.
   The controls stay visible, and the card itself should not push the canvas off-screen. */
.game-stage--play{
  overflow: hidden;
  display: flex;
  flex-direction: column;
  height: calc(100svh - var(--nav-h) - 150px);
}

/* Fullscreen-style embedded game (Games section -> playing). */
.game-stage--fullscreen{
  overflow: hidden;
  display: flex;
  flex-direction: column;
  height: 100%;
  min-height: 0;
  padding: 12px;
}

/* In fullscreen play mode, prioritize the canvas area (hide long help text on small screens). */
.game-fullscreen .bb-hint,
.game-fullscreen .tt-hint{
  display: none;
}

.game-fullscreen .bb-topbar,
.game-fullscreen .tt-topbar{
  margin-bottom: 8px;
}

.game-fullscreen .tt-host{
  flex: 1;
  min-height: 0;
}

/* When a game is fullscreen on mobile, hide long instruction text so the canvas can fill the viewport. */
.game-fullscreen .game-hint{
  display: none;
}

.leaderboard-sheet{
  max-height: calc(90svh - var(--nav-h));
  overflow: auto;
}

/* ------------------------------------------------------------
   Mobile landscape: maximize usable height/width
   - Move navbar to a fixed right sidebar (handled by Navbar.tsx)
   - Give pages room so content isn't hidden under the sidebar
   - Avoid 100vh issues on iOS by preferring svh/dvh
------------------------------------------------------------- */
@media (max-width: 900px) and (orientation: landscape){
  :root{
    --nav-h: 0px;
    --nav-w: 150px;
  }

  body{
    padding-right: calc(var(--nav-w) + env(safe-area-inset-right, 0px));
  }

  .snap-container{
    height: 100dvh;
    height: 100svh;
    margin-top: 0;
  }

  .snap-section{
    min-height: 100dvh;
    min-height: 100svh;
  }

  /* Two-column helper: left text, right primary content (game / PDF) */
  .ml-split{ display: flex; gap: 14px; align-items: stretch; }
  .ml-left{ flex: 0 0 240px; min-width: 200px; }
  .ml-right{ flex: 1 1 auto; min-width: 0; }
  .ml-fill{ height: calc(100dvh - 24px); height: calc(100svh - 24px); }
}

@media (max-width: 640px){
  .game-stage{
    max-height: calc(100svh - var(--nav-h) - 140px);
  }

  .game-stage--play{
    height: calc(100svh - var(--nav-h) - 120px);
  }

  .game-stage--fullscreen{
    padding: 10px;
  }

  /* Leaderboard opens as a full-screen sheet on mobile */
  .leaderboard-sheet{
    height: calc(100svh - var(--nav-h) - 16px);
    max-height: calc(100svh - var(--nav-h) - 16px);
    border-radius: 24px;
    overflow: auto;
  }
}


/* Slightly nicer text rendering */
* { -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }


/* ===== iOS / Safari backdrop-filter reliability =====
   Safari often requires the prefixed property. We provide:
   1) A `.glass` class that reads `--glass-bdf` and applies both properties.
   2) A safety net for Tailwind's backdrop-* utilities by mirroring to -webkit-.
*/
@supports ((-webkit-backdrop-filter: blur(1px)) or (backdrop-filter: blur(1px))) {
  .glass {
    -webkit-backdrop-filter: var(--glass-bdf, blur(18px) saturate(160%));
    backdrop-filter: var(--glass-bdf, blur(18px) saturate(160%));
    /* Help Safari keep the blur alive in nested stacking contexts */
    will-change: backdrop-filter;
    isolation: isolate;
    background-clip: padding-box;
  }

  /* Tailwind safety net (uses --tw-backdrop-filter) */
  [class*="backdrop-"] {
    -webkit-backdrop-filter: var(--tw-backdrop-filter);
  }
}

